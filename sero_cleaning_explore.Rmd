---
title: "sero results data"
author: "Reinpeter"
date: "`r Sys.Date()`"
output:
  word_document: 
    number_sections: yes
  pdf_document:
    number_sections: yes
  html_document:
    toc: yes
    toc_depth: 4
    number_sections: yes
---

# **Introduction**

This study titled [**Surveillance and epidemiologic evaluation of COVID-19, DFID-2019 Serosurveillance Project**](https://microdataportal.aphrc.org/index.php/catalog/138/study-description) was under the **Health and Well-Being (HaW) Theme** and aimed to describe the clinical, demographic, and genomic profile, trends, clinical course and outcomes of patients with COVID-19 through surveillance. It was carried out from Individual respondents who are residents of Korogocho and Viwandani.


# **Data**

Data collected electronically using (SARS COV-2 Sero-survey - Questionnaire) included:

* Sociodemographic information: Participants name, ethnicity, education, religion, age, gender, place of residence.

* Health information: Access to prevention services, risk of exposure to COVID 19, outmigration and inmigration information, vaccination status of children participants, laboratory information including blood sample collection and blood grouping.


```{r setup, results="hide", include=FALSE}

## Set Chunk requirements
knitr::opts_chunk$set(#include = TRUE,
                      echo=FALSE, message = FALSE, warning = FALSE)

```

```{r setting working directory, include=FALSE, results = "hide"}

## Setting work directory

setwd(".")

```

```{r loading relevant packages, include=FALSE, results = "hide"}

#library we need
libs_sero_clean <- c("googledrive" ,"tidyverse", "haven", "janitor", "knitr",
                            "lubridate", "plotly", "gtsummary", "flextable", "factoextra")

#install missing libraries

inatalled_libs_sero_clean <- libs_sero_clean  %in% rownames(installed.packages())
if (any(inatalled_libs_sero_clean==F)) {
  install.packages(libs_sero_clean[!inatalled_libs_sero_clean])
}

#load libraries

invisible(lapply(libs_sero_clean, library, character.only=T))


set_gtsummary_theme(list(
  "tbl_summary-fn:percent_fun" = function(x) style_percent(x, digits = 1),
  "tbl_summary-str:categorical_stat" = "{n} ({p}%)"
))
# Setting `Compact` theme
theme_gtsummary_compact()

```


```{r googledrive downloading sero data, results="hide", include=FALSE}

 drive_auth(#email = "guest360@aphrc.org"
           )

  #drive_user()

  sero_file_id <- drive_find(shared_drive = c(shared_drive_find(pattern = "Data Science Programs")$id),
           q = c("name contains 'sero_results_data.dta'")) #search for a specific set of shared drives, use the query string q

  sero_local_download <- drive_download(sero_file_id$id, overwrite = TRUE)
  
```


```{r reading sero data locally, results="hide", include=FALSE}

  ##Reading the .dta
  sero <- read_dta(paste0(sero_local_download$local_path))%>%
  mutate_if(is.labelled, as_factor)%>%
   labelled::set_variable_labels( #labeling unlabeled variables and relabling for final data dictionary
  q8_gender = "The gender of the participant",
  q7_age = "Participant's age in complete years",
  age_group = "Participant's age group",
  age_strata = "Participant's age strata",
  q5_status = "Participant current status",
  q11_fever = "In the past 6 months, has the participant experienced history of fever/chills",
  q11_shortness_breath = "In the past 6 months, has the participant experienced shortness of breath",
  q11_pain = "In the past 6 months, has the participant experienced pain (muscular/chest/abdominal/joint)",
  q11_weakness = "In the past 6 months, has the participant experienced general weakness",
  q11_diarrhoea = "In the past 6 months, has the participant experienced diarrhoea",
  q11_cough = "In the past 6 months, has the participant experienced cough",
  q11_nausea = "In the past 6 months, has the participant experienced nausea/vomiting",
  q11_sore_throat = "In the past 6 months, has the participant experienced sore throat",
  q11_headache = "In the past 6 months, has the participant experienced headache",
  q11_runny_nose = "In the past 6 months, has the participant experienced runny nose",
  q11_irritability = "In the past 6 months, has the participant experienced irritability/confusion",
  q11_lost_smell = "In the past 6 months, has the participant experienced loss of sense of smell or taste",
  q11_other_symptom = "In the past 6 months, has the participant experienced other symptom",
  q11_symptom_specified = "In the past 6 months, has the participant experienced other symptom-specify",
  q11_unknown = "In the past 6 months, has the participant experienced unknown(all)",
  q11_no_symptoms = "In the past 6 months, has the participant experienced no symptoms",
  q11_muscular_pain = "In the past 6 months, has the participant experienced muscular pain",
  q11_chest_pain = "In the past 6 months, has the participant experienced chest pain",
  q11_abdominal_pain = "In the past 6 months, has the participant experienced abdominal pain",
  q11_joint_pain = "In the past 6 months, has the participant experienced joint pain",
  q12_medical_attention = "Whether the mentioned symptoms required the participant to seek medical attention",
  q12_miss_work = "Whether the mentioned symptoms made the participant to miss work",
  q12_hospitalized = "Whether the mentioned symptoms made the participant to be hospitalized",
  q16_info_edu = "How accessible the COVID-19 prevention services are in community including information and education",
  q16_hand_wash = "How accessible the COVID-19 prevention services are in community including hand washing",
  q16_face_masks = "How accessible the COVID-19 prevention services are in community including face masks",
  q16_sanitizers = "How accessible the COVID-19 prevention services are in community including hand sanitizers",
  q13_hhm_fever = "In the past 6 months, has anybody from the participant household been sick with symtoms of fever/chills",
  q13_hhm_shortness_breath = "In the past 6 months, has anybody from the participant household been sick with symtoms of shortness of breath",
  q13_hhm_pain = "In the past 6 months, has anybody from the participant household been sick with symtoms of pain (muscular/chest/abdominal/joint)",
  q13_hhm_weakness = "In the past 6 months, has anybody from the participant household been sick with symtoms of general weakness",
  q13_hhm_diarrhoea = "In the past 6 months, has anybody from the participant household been sick with symtoms of diarrhoea",
  q13_hhm_cough = "In the past 6 months, has anybody from the participant household been sick with symtoms of cough",
  q13_hhm_nausea = "In the past 6 months, has anybody from the participant household been sick with symtoms of nausea/vomiting",
  q13_hhm_sore_throat = "In the past 6 months, has anybody from the participant household been sick with symtoms of sore throat",
  q13_hhm_headache = "In the past 6 months, has anybody from the participant household been sick with symtoms of headache",
  q13_hhm_runny_nose = "In the past 6 months, has anybody from the participant household been sick with symtoms of runny nose",
  q13_hhm_irritability = "In the past 6 months, has anybody from the participant household been sick with symtoms of irritability/confusion",
  q13_hhm_lost_smell = "In the past 6 months, has anybody from the participant household been sick with symtoms of loss of sense of smell or taste",
  q13_hhm_other_symptom = "In the past 6 months, has anybody from the participant household been sick with other symtoms",
  q13_hhm_no_symptoms = "In the past 6 months, has anybody from the participant household experienced no symptoms",
  q13_hhm_unknown = "In the past 6 months, has anybody from the participant household been sick with unknown(all)",
  q13_hhm_symptom_specified = "In the past 6 months, has anybody from the participant household been sick with other symtoms-specify",
  q13_hhm_muscular_pain = "In the past 6 months, has anybody from the participant household been sick with symtoms of muscular pain",
  q13_hhm_chest_pain = "In the past 6 months, has anybody from the participant household been sick with symtoms of chest pain",
  q13_hhm_abdominal_pain = "In the past 6 months, has anybody from the participant household been sick with symtoms of abdominal pain",
  q13_hhm_joint_pain = "In the past 6 months, has anybody from the participant household been sick with symtoms of joint pain",
  q13_hhm_symptoms_cause = "In the past 6 months, has anybody from the participant household been sick with symtoms. If yes, reported cause of   symptoms",
  q14_hhm_medical_attention = "Whether any of these symptoms required household member to seek medical attention",
  q14_hhm_miss_work = "Whether any of these symptoms caused household member to miss work",
  q14_hhm_hospitalized = "Whether any of these symptoms required household member to be hospitalised",
  q15_hhm_died = "Whether in the last 6 months, any member of the participants household has died",
  q17_electricity = "Participant household has electricity",
  q17_television = "Participant household has a television",
  q17_sofa = "Participant household has a sofa",
  q17_cupboard = "Participant household has a cupboard",
  q17_dvd_player = "Participant household has a DVD player",
  q17_radio = "Participant household has a radio",
  q17_tables = "Participant household has a table",
  q17_clock = "Participant household has a clock",
  q17_none = "The participant household has no: electricity/television/sofa/cupboard/DVD player/radio/table/clock",
  q22_reason_nocard = "Reason for no vaccination records",
  spikepos = "sero positive"
 )

sero1 <- read_dta(paste0(sero_local_download$name))

sero_variable_attr <- as.data.frame(labelled::generate_dictionary(sero, labels = TRUE, values = TRUE))

sero_variable_attr1 <- as.data.frame(labelled::look_for(sero1, labels = TRUE, values = TRUE))

```


```{r saving data localy, results="hide", include=FALSE}
#saving as .csv
readr::write_csv(sero,"sero_results_data.csv", na="")

```


```{r reading scan report, results="hide", include=FALSE}

#downloading data from shared google drive

scan_report_id <- drive_find(shared_drive = c(shared_drive_find()$id),
           q = c("name contains 'ScanReport_sero.xlsx'")) #search for a specific set of shared drives, use the query string q

scan_report_local_download <- drive_download(scan_report_id$id, overwrite = TRUE)

```


```{r assigning variable labels, results="hide", include=FALSE}

#Creating a named vector to quickly assign the variable labels

sero_labels <- sero_variable_attr%>%
  select(variable, label)%>%
  deframe()

```


```{r sero final data , results="hide", include=FALSE}

sero_final <- sero%>%
    mutate(
      spikepos = ifelse(spikepos == 0, "no",
                    ifelse(spikepos == 1, "yes", spikepos)),
         spikepos = fct_rev(as.factor(spikepos)))%>%
    mutate(across(c(q17_none, q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized),~ as.character(.x)), #columns to character
           q17_none = ifelse((rowSums(across(c(q17_electricity:q17_clock), ~.x=="missing:impute")))>0, "missing:impute",
                      ifelse((rowSums(across(c(q17_electricity:q17_clock), ~.x=="yes")))<1, "yes", "no")), #cleaning q17_none column
           q17_none = factor(q17_none, levels = c("yes", "no", "missing:impute")), #q17_none column to factor
            across(c(q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized),
                ~ ifelse(q13_hhm_no_symptoms== "yes", "NIU (not in universe)", .x)), #cleaning columns
           across(c(q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized),
                 ~factor(.x, levels = c("NIU (not in universe)", "no", "yes", "missing:impute"))) #columns to factor
           )%>%
   mutate(q7_age_new = round(time_length(difftime(today_date, q7_birth_date, units = "auto"), unit = "year"),1), #calculating age column
     age_group_new = ifelse(q7_age_new < 18, "less than 18 years",
                          ifelse(q7_age_new < 35, "18-34 years",
                          ifelse(q7_age_new < 50, "35-49 years", "50 years and above" ))), #group age column
          age_group_new = factor(age_group_new, levels = c("less than 18 years", "18-34 years",
                                                           "35-49 years", "50 years and above")) #grouped age to factor
     )%>%
  mutate_if(is.factor, ~fct_drop(.x  ))%>% #drop unused factor levels
   labelled::set_variable_labels(#labeling created variables
     q7_age_new = "Participant's age in years new",
  age_group_new = "Participant's age group new"
   )%>% 
  labelled::set_variable_labels(!!!sero_labels[names(sero_labels) %in% names(.)]) #labeling variables from data dictionary

```


```{r sero final clean data, results="hide", include=FALSE}

sero_final_clean <- sero_final%>%
               mutate(
      across(c(q12_medical_attention, q12_miss_work, q12_hospitalized, q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized),
                    ~ fct_recode(.x, "No Symptoms" = "NIU (not in universe)")), #change factor level "NIU (not in universe)" to "No Symptoms"
      q20_services_missed = fct_recode(q20_services_missed,
                              "No services missed" = "NIU (not in universe)"), #change factor level "NIU (not in universe)" to "No services missed"
      across(c(q13_hhm_fever:q13_hhm_other_symptom, q11_muscular_pain:q11_joint_pain, q13_hhm_muscular_pain:q13_hhm_joint_pain, q13_hhm_unknown
                #,q12_medical_attention, q12_miss_work, q12_hospitalized, q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized
                  ), ~ fct_collapse(.x, no = c("no", "NIU (not in universe)"))), #changing factor level "NIU (not in universe)" to "no"
      q13_hhm_no_symptoms = fct_collapse(q13_hhm_no_symptoms,
                                      yes = c("yes", "NIU (not in universe)")), #changing factor level "NIU (not in universe)" to "yes"
      q13_hhmember_sick = fct_collapse(q13_hhmember_sick, yes = c("yes", "98")) #changing factor level "98" to "yes"
      )%>%
               mutate(
              #q20_services_missed = na_if(q20_services_missed, "NIU (not in universe)"), #replacing "NIU (not in universe)" to NA values
               across(c(q13_hhm_no_symptoms, q13_hhm_fever:q13_hhm_other_symptom, q13_hhm_muscular_pain:q13_hhm_joint_pain,
                            q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized, q17_electricity:q17_none,
                        q20_healthcare_access, q20_services_missed, q13_hhm_unknown, q22_vaccine_records, q22_reason_nocard,
                        bcg_confirm:mcv2), ~ na_if(.x, "missing:impute")) #replacing "missing:impute" to NA values
               )%>%
               mutate(across(c(q13_hhmember_sick, q13_hhm_no_symptoms, q13_hhm_fever:q13_hhm_other_symptom, 
                    q13_hhm_muscular_pain:q13_hhm_joint_pain, q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized,
                    q17_electricity:q17_none, q20_healthcare_access, q20_services_missed, q13_hhm_unknown, q22_vaccine_records, q22_reason_nocard,
                    bcg_confirm:mcv2), ~ fct_drop(.x, only = c("missing:impute"))))%>% #dropping specific unused factors in columns
   labelled::set_variable_labels(!!!sero_labels[names(sero_labels) %in% names(.)]) #labeling variables from data dictionary

```


```{r pca socio economic status, results="hide", fig.width=10, fig.height=6}

#Principal component analysis on socio economic variables

ses_df <- sero_final_clean%>%
  dplyr::select(studyid, q17_electricity:q17_clock, q17_floor_type, q17_wall_type, q17_roof_type, q17_fuel_type, q17_toilet_type)%>%
  mutate(across(c(q17_electricity:q17_clock), ~ fct_rev(.x)))%>%
  mutate(q17_floor_type = factor(q17_floor_type, levels = c("earth/sand", "cement","other")))%>%
  mutate(q17_fuel_type = factor(q17_fuel_type, levels = c("other", "wood","kerosene", "charcoal", "lpg/natural gas","electricity")))%>%
  mutate(across(everything(), ~as.numeric(.x)) )%>%
  drop_na()

  
### Perform PCA

#prcomp() uses the singular value decomposition (SVD) which examines the covariances / correlations between individuals

ses_pca <- prcomp(ses_df[,-1], center = TRUE, scale. = TRUE)

pca_summ <- summary(ses_pca)
print(pca_summ)


#The first principal component explains the largest proportion of the total variance and it is used as the wealth index to represent the 
#household's wealth
ses_index <- ses_pca$x[, 1, drop=TRUE]

loadings <- pca_summ$rotation[, 1, drop=TRUE]
loadings

## Variance explained plot
#Visualize eigenvalues (scree plot). Show the percentage of variances explained by each principal component.
ses_explained_plot <- fviz_screeplot(ses_pca, addlabels = TRUE)
print(ses_explained_plot)

## PC plots
#Graph of variables. Positive correlated variables point to the same side of the plot. Negative correlated variables point to opposite sides 
#of the graph.

ses_pc_plot <- fviz_pca_var(ses_pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = FALSE     # Avoid text overlapping
             )

print(ses_pc_plot)


```

```{r sero final data for analysis, results="hide", include=FALSE}

sero_final_clean <- (sero_final_clean%>%
                    left_join(ses_df%>%   
                       mutate(ses_index = ses_index)%>%
                         dplyr::select(studyid, ses_index), by = c("studyid" = "studyid"))%>%
                       labelled::set_variable_labels(#labeling created variables
     ses_index = "Socio-economic index"
   )
	)

# make dataset with variables for descriptive and inferential statistics
sero_final_analysis <- sero_final_clean%>%
  dplyr::select( #socio-demographics
    spikepos, replace, q9_location, q8_gender, q6_education_level, age_group_new, q7_age_new, q6_religion,
                #health symptoms of participants
    q11_no_symptoms,q11_fever:q11_lost_smell, q11_muscular_pain:q11_joint_pain, q12_medical_attention, q12_miss_work, q12_hospitalized,
                #health symptoms of household members
   q13_hhmember_sick, q15_hhm_died, q13_hhm_no_symptoms, q13_hhm_fever:q13_hhm_lost_smell, 
                    q13_hhm_muscular_pain:q13_hhm_joint_pain, q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized,
                #COVID-19
   q10_covid_contact, q16_own_risk, q16_info_edu, q16_hand_wash, q16_face_masks, q16_sanitizers,
                                covid_vaccine, q19_lost_job, q20_healthcare_access, q20_services_missed,
                #socio-economic status
   q17_electricity:q17_none, q17_floor_type, q17_wall_type, q17_roof_type, q17_fuel_type, q17_toilet_type, ses_index,
                #Migration, vaccination and blood group
   q18_outmigrant_member, q18_inmigrant_member, q21_bcg_scar, q23_sampling, sample_type, blood_group
                )

```


```{r saving locally sero final clean data, results="hide", include=FALSE}

#final clean sero data
#saving as .Rdata
save(sero_final_clean, sero_final_analysis, file = "sero_results_data_clean_analysis.RData")

#saving as .csv
readr::write_csv(sero_final_clean%>%
                   dplyr::select(-c(q7_age_new, age_group_new, ses_index)),"sero_results_data_clean.csv", na="")

haven::write_dta(sero_final_clean%>%
                   dplyr::select(-c(q7_age_new, age_group_new, ses_index)),"sero_results_data_clean.dta")

```


```{r create sero ggplot theme, results="hide", include=FALSE}

# Creating own ggplot theme to be reused
sero_theme <-
    ggplot2::theme_minimal() +
    ggplot2::theme(
      legend.position="none",
  legend.text = element_text(size = 12),
  legend.title = element_text(size = 15, color = "red", face = "bold")
  ,axis.text.y = element_text(angle = 0, size = 14)
  ,axis.text.x = element_text(angle = 0, size = 14),
  #plot.title = element_text(vjust = 0.5, face = "bold", size = 16),
  plot.caption = element_text(angle = 0, size = 12, face = "italic"),
  axis.title.x = element_text(size = 16),
  axis.title.y = element_text(size = 16),
  #axis.line.y = element_line(colour = "black",inherit.blank = FALSE),
  panel.grid.major.y = element_blank(),
  panel.grid.major.x = element_line(color = "grey"),
  panel.grid.minor.x = element_blank()
      )

```


## Data description

* The data has `r ncol(sero)` variables and `r nrow(sero)` observations.

* All `r nrow(sero_final_clean[sero_final_clean$consent=="yes",])` individuals consented to participate in the research and all `r nrow(sero_final_clean[sero_final_clean$q5_status=="present",])` were present. 

* `r paste0(nrow(sero_final_clean[sero_final_clean$replace=="yes",]), "(",round((nrow(sero_final_clean[sero_final_clean$replace=="yes",])*100)/nrow(sero_final_clean),1), "%)")` of the participants were replaced.


```{r data description}

  tbl_summary(sero_final_clean%>%dplyr::select(consent, q5_status), 
                      type = list(
                        all_dichotomous() ~ "categorical")
              , digits = list(all_categorical() ~ c(0, 1))
                      , missing = "no" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Descriptives**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  as_flex_table() #covert gtsummary object to knitrkable object. also use as_flex_table() to maintain identation, footnotes, spanning headers

```

## Data Dictionary

Information about the attributes of sero data contains 6 columns namely:

- **pos:** Column position of variable in data
- **variable:** Study variable
- **label:** Description of study variable
- **col_type:** Data type. i.e dbl(numeric variable), fct(categorical variable), date(date variable), chr(character/string variable)
- **levels:** variable levels/categories
- **value_labels:** value of variable categories

```{r data dictionary, results='asis'}

kable(
  sero_variable_attr%>%
    mutate(value_labels = sero_variable_attr1$value_labels)
  )

```


## Data Analysis

The quantitative data was cleaned and analysed using R version 4.2.3 (2023). 

Descriptive summary statistics in form of frequency, percentage, mean and standard deviation were generated to examine socio-demographic, health symptoms, COVID-19, socio-economic, migration, vaccination and lab test variables.

Chi-square test and Fisher's exact test where appropriate were used for categorical data to analyze difference in proportion of socio-demographic, health symptoms, COVID-19, socio-economic, migration, vaccination and lab test variables as a function of outcome (sero positive), location, gender, school level and age group. 

For continous data, Wilcoxon rank sum test and Kruskal-Wallis rank sum test where appropriate was used to examine the comparison of outcome (sero positive), location, gender, school level and age group variables with age. 

The results are presented in narrative and summary tables. Statistical significance was set at p<0.05


# **Descriptive statistics**

```{r all variable descriptives}

 tbl_summary(sero_final_analysis, 
                      type = list(
                        all_dichotomous() ~ "categorical"
                        ,all_continuous() ~ "continuous2"
                        )
                      , statistic = all_continuous() ~ c(
                        "{mean} ({sd})",
                        "{median} ({p25}, {p75})",
                        "{min}, {max}" )
                      , digits = list(all_continuous() ~ 2, 
                                      all_categorical() ~ c(0, 1))
                      , missing = "always" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Variables**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  as_flex_table() #covert gtsummary object to knitrkable object. also use as_flex_table() to maintain identation, footnotes, spanning headers

```

## Outcome variable

* `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$spikepos=="yes" & !is.na(sero_final_clean$spikepos),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$spikepos),]),1), "%)")` of the participants had the likelihood they would be sero positive if the results were out.

## Sociodemographics of Participants

* Participants mean age was `r paste0(round(mean(sero_final_clean$q7_age_new),2)," (sd=", round(sd(sero_final_clean$q7_age_new),2), ")" )` years. 

* Majority of the respondents were from Viwandani `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q9_location=="viwandani",])*100)/nrow(sero_final_clean),1), "%)")`, with biggest proportion having primary school as highest level of education `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q6_education_level=="primary",])*100)/nrow(sero_final_clean),1), "%)")` and smallest proportion aged 35-49 years `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$age_group_new=="35-49 years",])*100)/nrow(sero_final_clean),1), "%)")`.

* More than half the participants were male `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q8_gender=="male",])*100)/nrow(sero_final_clean),1), "%)")` and the smallest proportion having no religion `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q6_religion=="none",])*100)/nrow(sero_final_clean),1), "%)")`.


## Health Symptoms of Participants

* `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_no_symptoms=="no",])*100)/nrow(sero_final_clean),1), "%)")` of the participants experienced at least one health symptom.

* Out of the 15 symptoms experienced, the top 6 (in descending order) were:

1. cough `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_cough=="yes",])*100)/nrow(sero_final_clean),1), "%)")`
2. headache `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_headache=="yes",])*100)/nrow(sero_final_clean),1), "%)")`
3. runny nose `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_runny_nose=="yes",])*100)/nrow(sero_final_clean),1), "%)")`
4. fever `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_fever=="yes",])*100)/nrow(sero_final_clean),1), "%)")` 
5. weakness `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_weakness=="yes",])*100)/nrow(sero_final_clean),1), "%)")`
6. sore throat `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q11_sore_throat=="yes",])*100)/nrow(sero_final_clean),1), "%)")` 


```{r, fig.width=10, fig.height=6}

 sero_final_clean%>%
  dplyr::select(q11_fever, q11_shortness_breath, q11_weakness:q11_lost_smell, q11_muscular_pain:q11_joint_pain)%>%
  pivot_longer(cols = everything(),
               names_to = "symptoms",
               values_to = "value")%>%
  mutate(n = 1,
         symptoms = str_replace(symptoms, "q11_", ""),
         symptoms = gsub("_", " ", symptoms),
         value = as.character(value))%>%
  filter(value=="yes")%>%
  group_by(symptoms, value)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  arrange(n)%>%
  mutate(p = round((n/nrow(sero_final_clean))*100,1),
         symptoms = as_factor(symptoms))%>%
  ggplot(aes(fill=value, y = n, x=symptoms))+
  geom_bar(position = "dodge", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )), vjust=0.4, hjust=-0.1,
            position = position_dodge(0.9), color="black", size=4.5)+
  #scale_y_continuous(n.breaks = 5)+
  scale_y_continuous(breaks = seq(0, 450, by = 50), limits = c(0, 450))+
  sero_theme+
  geom_hline(yintercept = 0, color = "black")+
  labs(title = "", x= "Symptoms of Participants", y="n", fill="", caption = "N=870")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))

```

* Participants who experienced at least one pain symptom were `r paste0(nrow(sero_final_clean[sero_final_clean$q11_pain=="yes",]), "(",round((nrow(sero_final_clean[sero_final_clean$q11_pain=="yes",])*100)/nrow(sero_final_clean),1), "%)")`.  

* Of the `r nrow(sero_final_clean[sero_final_clean$q11_no_symptoms=="no",])` participants who experienced at least one health symptom, majority `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q12_medical_attention=="yes",])*100)/nrow(sero_final_clean[sero_final_clean$q11_no_symptoms=="no",]),1), "%)")` required medical attention and the least `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q12_hospitalized=="yes",])*100)/nrow(sero_final_clean[sero_final_clean$q11_no_symptoms=="no",]),1), "%)")` required to be hospitalized.


```{r, fig.width=10, fig.height=6}

  sero_final_clean%>%
  dplyr::select(q12_medical_attention, q12_miss_work, q12_hospitalized)%>%
  pivot_longer(cols = everything(),
               names_to = "cause",
               values_to = "value")%>%
  mutate(n = 1,
         cause = str_replace(cause, "q12_", ""),
         cause = ifelse(cause == "medical_attention", "seek medical attention",
                 ifelse(cause == "miss_work", "miss work", "be hospitalized")),
         value = as.character(value))%>%
  filter(value=="yes")%>%
  group_by(cause, value)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  arrange(n)%>%
  mutate(p = round((n/nrow(sero_final_clean[sero_final_clean$q11_no_symptoms=="no",]))*100,1),
         cause = as_factor(cause))%>%
  ggplot(aes(fill=value, y = n, x=cause))+
  geom_bar(position = "dodge", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )), vjust=0.4, hjust=-0.1,
            position = position_dodge(0.9), color="black", size=4.5)+
  #scale_y_continuous(n.breaks = 5)+
  scale_y_continuous(breaks = seq(0, 450, by = 50), limits = c(0, 455))+
  sero_theme+
  geom_hline(yintercept = 0, color = "black")+
  labs(x= "Did any of these symptoms\n require you to...", y="n", fill="", caption = "Participants who had\n symptoms: N=689")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))

```

## Health Symptoms of Household members

* In the last 6 months, more than half of participants household members had not been sick `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhmember_sick=="no",])*100)/nrow(sero_final_clean),1), "%)")` and majority had not died `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q15_hhm_died=="no",])*100)/nrow(sero_final_clean),1), "%)")`. 

* `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_no_symptoms=="no" & !is.na(sero_final_clean$q13_hhm_no_symptoms),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_no_symptoms),]),1), "%)")` of the participants household members experienced at least one health symptom with cough `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_cough=="yes" & !is.na(sero_final_clean$q13_hhm_cough),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_cough),]),1), "%)")` being the most experienced symptom, followed by fever `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_fever=="yes" & !is.na(sero_final_clean$q13_hhm_fever),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_fever),]),1), "%)")`, runny nose `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_runny_nose=="yes" & !is.na(sero_final_clean$q13_hhm_runny_nose),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_runny_nose),]),1), "%)")` , headache `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_headache=="yes" & !is.na(sero_final_clean$q13_hhm_headache),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_headache),]),1), "%)")` weakness `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_weakness=="yes" & !is.na(sero_final_clean$q13_hhm_weakness),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_weakness),]),1), "%)")` and sore throat `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_sore_throat=="yes" & !is.na(sero_final_clean$q13_hhm_sore_throat),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_sore_throat),]),1), "%)")` 


```{r, fig.width=10, fig.height=6}

  sero_final_clean%>%
  dplyr::select(q13_hhm_fever, q13_hhm_shortness_breath, q13_hhm_weakness:q13_hhm_lost_smell, q13_hhm_muscular_pain:q13_hhm_joint_pain)%>%
  pivot_longer(cols = everything(),
               names_to = "symptoms",
               values_to = "value",
               values_drop_na = TRUE)%>%
  mutate(n = 1,
         symptoms = str_replace(symptoms, "q13_", ""),
         symptoms = gsub("_", " ", symptoms),
         value = as.character(value))%>%
  filter(value=="yes")%>%
  group_by(symptoms, value)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  arrange(n)%>%
  mutate(p = round((n/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_no_symptoms),]))*100,1),
         symptoms = as_factor(symptoms))%>%
  ggplot(aes(fill=value, y = n, x=symptoms))+
  geom_bar(position = "dodge", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )), vjust=0.4, hjust=-0.1,
            position = position_dodge(0.9), color="black", size=4.5)+
  #scale_y_continuous(n.breaks = 5)+
  scale_y_continuous(breaks = seq(0, 200, by = 40), limits = c(0, 200))+
  sero_theme+
  geom_hline(yintercept = 0, color = "black")+
  labs(x= "Symptoms of Household members", y="n", fill="", caption = "hhm=household member\n N=869")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))
  
```


* Participants household members who experienced at least one pain symptom were `r paste0(nrow(sero_final_clean[sero_final_clean$q13_hhm_pain =="yes" & !is.na(sero_final_clean$q13_hhm_pain),]), "(",round((nrow(sero_final_clean[sero_final_clean$q13_hhm_pain=="yes" & !is.na(sero_final_clean$q13_hhm_pain),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q13_hhm_pain),]),1), "%)")`.

* Of the `r nrow(sero_final_clean[sero_final_clean$q13_hhm_no_symptoms=="no" & !is.na(sero_final_clean$q13_hhm_no_symptoms),])` participants household members who experienced at least one health symptom, majority required medical attention `r paste0("(",round((nrow(sero_final_clean[ !is.na(sero_final_clean$q14_hhm_medical_attention) & sero_final_clean$q14_hhm_medical_attention=="yes",])*100)/nrow(sero_final_clean[sero_final_clean$q13_hhm_no_symptoms=="no" & !is.na(sero_final_clean$q13_hhm_no_symptoms),]),1), "%)")` and the least required to be hospitalized `r paste0("(",round((nrow(sero_final_clean[!is.na(sero_final_clean$q14_hhm_hospitalized) & sero_final_clean$q14_hhm_hospitalized=="yes",])*100)/nrow(sero_final_clean[sero_final_clean$q13_hhm_no_symptoms=="no" & !is.na(sero_final_clean$q13_hhm_no_symptoms),]),1), "%)")`.


```{r, fig.width=10, fig.height=6}

  sero_final_clean%>%
  dplyr::select(q14_hhm_medical_attention, q14_hhm_miss_work, q14_hhm_hospitalized)%>%
  pivot_longer(cols = everything(),
               names_to = "cause",
               values_to = "value",
               values_drop_na = TRUE)%>%
  mutate(n = 1,
         cause = str_replace(cause, "q14_", ""),
         cause = ifelse(cause == "hhm_medical_attention", "seek medical attention",
                 ifelse(cause == "hhm_miss_work", "miss work", "be hospitalized")),
         value = as.character(value))%>%
  filter(value=="yes")%>%
  group_by(cause, value)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  arrange(n)%>%
  mutate(p = round((n/nrow(sero_final_clean[sero_final_clean$q13_hhm_no_symptoms=="no" & !is.na(sero_final_clean$q13_hhm_no_symptoms),]))*100,1),
         cause = as_factor(cause))%>%
  ggplot(aes(fill=value, y = n, x=cause))+
  geom_bar(position = "dodge", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )), vjust=0.4, hjust=-0.1,
            position = position_dodge(0.9), color="black", size=4.5)+
  #scale_y_continuous(n.breaks = 5)+
  scale_y_continuous(breaks = seq(0, 250, by = 50), limits = c(0, 250))+
  sero_theme+
  geom_hline(yintercept = 0, color = "black")+
  labs(x= "Did any of these symptoms require\n household members to...", y="n", fill="", caption = "Household members who\n had symptoms: N=283")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))
  
```


## COVID-19

### COVID-19 Contact and Risk

* Majority of participants stated they had no contact with anyone with suspected or confirmed COVID-19 `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q10_covid_contact=="no",])*100)/nrow(sero_final_clean),1), "%)")` and the least proportion rated their own risk of getting infected with the virus that causes COVID-19 as **nil** `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q16_own_risk=="nil",])*100)/nrow(sero_final_clean),1), "%)")`.

### COVID-19 Prevention services

* More than half of the participants highly rated Face masks `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q16_face_masks=="highly",])*100)/nrow(sero_final_clean),1), "%)")` and Handwashing (water and soap) `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q16_hand_wash=="highly",])*100)/nrow(sero_final_clean),1), "%)")` as accessible COVID-19 prevention services.

* Hand sanitizers had the highest rating of rarely accessible `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q16_sanitizers=="rarely",])*100)/nrow(sero_final_clean),1), "%)")`  and not accessible `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q16_sanitizers=="not accessible",])*100)/nrow(sero_final_clean),1), "%)")` COVID-19 prevention service compared to the other prevention services. 

```{r covid-19 Prevention services ggplot, fig.width=10, fig.height=6}

     sero_final_clean%>%
      dplyr::select(q16_info_edu, q16_hand_wash, q16_face_masks, q16_sanitizers)%>%
  pivot_longer(cols = everything(),
               names_to = "prevention",
               values_to = "value")%>%
  mutate(n = 1)%>%
  group_by(prevention, value)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  mutate(p = round((n/nrow(sero_final_clean))*100,1),
         prevention = ifelse(prevention == "q16_info_edu", "Information & Education",
                      ifelse(prevention == "q16_hand_wash", "Hand washing (water & soap)", 
                      ifelse(prevention == "q16_face_masks", "Face masks", "Hand Sanitizers"))),
         prevention = fct_rev(as_factor(prevention)),
         value = fct_rev(as_factor(value)))%>%
  ggplot(aes(fill=value, y = n, x=prevention))+
  geom_bar(position = "fill", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )),
            position = position_fill(vjust=0.5), color="black", angle = 45, size=3.9, fontface = "bold")+
  scale_y_continuous(labels = scales::percent)+
  theme_minimal()+
  theme(legend.position="top",
  legend.text = element_text(size = 14),
  legend.title = element_text(size = 14, color = "red", face = "bold")
  ,axis.text.y = element_text(angle = 0, size = 14)
  ,axis.text.x = element_blank(),
  #plot.title = element_text(vjust = 0.5, face = "bold", size = 16),
  plot.caption = element_text(angle = 0, size = 12, face = "italic"),
  axis.title.x = element_text(size = 16),
  axis.title.y = element_text(size = 16),
  #axis.line.y = element_line(colour = "black",inherit.blank = FALSE),
  panel.grid.major.y = element_blank(),
  panel.grid.major.x = element_blank(),
  panel.grid.minor.x = element_blank())+
  geom_hline(yintercept = 0, color = "black")+
  labs(x= "How accessible are COVID-19 prevention\n services in this community?", y="", fill="",
       caption = "N=870")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))
    
```


### COVID-19 vaccine and Job loss

* The lowest proportion of the participants had received the covid-19 vaccine `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$covid_vaccine=="yes",])*100)/nrow(sero_final_clean),1), "%)")`.

* Majority of the participants and their household members `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q19_lost_job=="no",])*100)/nrow(sero_final_clean),1), "%)")` had not lost a job or source livelihood in the last 6 months due to covid-19.


### Accessibility to Healthcare

* During covid-19,majority of the participants `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q20_healthcare_access=="no" & !is.na(sero_final_clean$q20_healthcare_access),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q20_healthcare_access),]),1), "%)")` were able to access and use healthcare services they would normally have access.

* Of the `r nrow(sero_final_clean[sero_final_clean$q20_healthcare_access=="yes" & !is.na(sero_final_clean$q20_healthcare_access),])` participants unable to access and use healthcare services they would normally have access during covid 19, majority `r paste0("(",round((nrow(sero_final_clean[ sero_final_clean$q20_services_missed == "consultation/treatment for chronic conditions e.g diabetes, hypertension,stroke care, sickle cell disease, etc" & !is.na(sero_final_clean$q20_services_missed),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q20_services_missed) & sero_final_clean$q20_services_missed != "No services missed",]),1), "%)")` missed services in consultation/treatment for chronic conditions e.g diabetes, hypertension,stroke care, sickle cell disease, etc .


```{r covid 19 access to health services, fig.width=10, fig.height=6}

  sero_final_clean%>%
  dplyr::select(q20_services_missed)%>%
    filter(!is.na(q20_services_missed), q20_services_missed!= "No services missed")%>%
  mutate(n = 1,
         q20_services_missed = as.character(q20_services_missed))%>%
  mutate(q20_services_missed = ifelse(q20_services_missed == "consultation/treatment for chronic conditions e.g diabetes, hypertension,stroke care, sickle cell disease, etc", "consultation/treatment for chronic\n conditions e.g diabetes, hypertension,\n stroke care, sickle cell disease, etc",
                                      q20_services_missed))%>%
  group_by(q20_services_missed)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  arrange(n)%>%
  mutate(p = round((n/nrow(sero_final_clean[!is.na(sero_final_clean$q20_services_missed) & sero_final_clean$q20_services_missed != "No services missed",] ))*100,1),
         q20_services_missed = as_factor(q20_services_missed))%>%
  ggplot(aes(y = n, x=q20_services_missed, fill = q20_services_missed ))+
  geom_bar(position = "dodge", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )), vjust=0.4, hjust=-0.1,
            position = position_dodge(0.9), color="black", size=4.5)+
  #scale_y_continuous(n.breaks = 5)+
  scale_y_continuous(breaks = seq(0, 100, by = 20), limits = c(0, 115))+
  sero_theme+
  geom_hline(yintercept = 0, color = "black")+
  labs(x= "Services missed you would normally\n have access to:", y="n", fill="", caption = "N=105")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))
  

```


## Socio-economic status of participants

* `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_none=="no" & !is.na(sero_final_clean$q17_none),])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q17_none),]),1), "%)")` of the participants had at least one household item. Majority of the participants households had electricity `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_electricity=="yes" & !is.na(sero_final_clean$q17_electricity) ,])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q17_electricity),]),1), "%)")` followed by television `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_television=="yes" & !is.na(sero_final_clean$q17_television) ,])*100)/nrow(sero_final_clean[!is.na(sero_final_clean$q17_television),]),1), "%)")`. 

* The biggest proportion of households had cement floor `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_floor_type=="cement",])*100)/ nrow(sero_final_clean),1), "%)")`, mabati external walls `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_wall_type=="mabati",])*100)/ nrow(sero_final_clean),1), "%)")`, iron sheet roofs `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_roof_type=="iron sheet",])*100)/nrow(sero_final_clean),1), "%)")` and cooked using charcoal `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_fuel_type=="charcoal",]) *100)/nrow(sero_final_clean),1), "%)")` with the smallest proportion having no toilet facility `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q17_toilet_type=="no facility/bush/field",])*100)/nrow(sero_final_clean),1), "%)")`.


```{r socio economic ggplot, fig.width=10, fig.height=6}

  sero_final_clean%>%
  dplyr::select(q17_electricity:q17_clock)%>%
  pivot_longer(cols = everything(),
               names_to = "household",
               values_to = "value",
               values_drop_na = TRUE)%>%
  mutate(n = 1,
         household = str_replace(household, "q17_", ""),
         value = as.character(value),
         household = gsub("_", " ", household))%>%
  filter(value == "yes")%>%
  group_by(household, value)%>%
  summarise(n = sum(n), .groups = 'drop')%>%
  arrange(desc(value), n)%>%
  mutate(p = round((n/nrow(sero_final_clean[!is.na(sero_final_clean$q17_none),]))*100,1),
         household = as_factor(household),
         value = as.factor(value))%>%
  ggplot(aes(fill=value, y = n, x=household))+
  geom_bar(position = "dodge", stat = "identity", width=0.8)+
  geom_text(aes(label= paste0(n," (", p,"%)" )), vjust=0.4, hjust=-0.1,
            position = position_dodge(0.9), color="black", size=4.5)+
  #scale_y_continuous(n.breaks = 5)+
  scale_y_continuous(breaks = seq(0, 800, by = 100), limits = c(0, 900))+
  sero_theme+
  geom_hline(yintercept = 0, color = "black")+
  labs(x= "Does your household have:", y="n", fill="", caption = "N=868")+
  coord_flip()+
  guides(fill= guide_legend(reverse = TRUE))
  
```

```{r ses index ggplot histogram, fig.width=10, fig.height=6}

sero_final_clean%>%
  dplyr::select(ses_index)%>%
  ggplot(aes(x = ses_index))+ 
  geom_histogram(bins = 50, color = "black", fill = "gray") +
  geom_vline(aes(xintercept = mean(ses_index, na.rm=TRUE)), 
             linetype = "dashed", size = 0.6)+
  scale_x_continuous(n.breaks = 10)

#By default, geom_histogram() uses 30 bins - this might not be good default. You can change the number of bins (e.g.: bins = 50) or the bin width
#(e.g.: binwidth = 0.5)
#The y axis corresponds to the count of weight values. If you want to change the plot in order to have the density on y axis, specify the 
#argument y = ..density.. in aes().

```

```{r ses index ggplot histogram and density, fig.width=10, fig.height=6}

sero_final_clean%>%
  dplyr::select(ses_index)%>%
  ggplot(aes(x = ses_index))+ 
  geom_histogram(aes(y = ..density..), bins = 50, color = "black", fill = "white") +
  geom_density(alpha = 0.2, fill = "#FF6666") +
  geom_vline(aes(xintercept = mean(ses_index, na.rm=TRUE)), 
             linetype = "dashed", size = 0.6)+
  scale_x_continuous(n.breaks = 10)


```

## Migration, vaccination and blood group

### Migration information

* Majority of the participants households had members who had not left `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q18_outmigrant_member =="no",])*100)/ nrow(sero_final_clean),1), "%)")` and not joined `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q18_inmigrant_member =="no",])*100)/ nrow(sero_final_clean),1), "%)")` in the last 6 months.

### Vaccination

* Majority of the participants had a BCG scar `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q21_bcg_scar =="yes",])*100)/ nrow(sero_final_clean),1), "%)")` to indicate they have been BCG-vaccinated.

### Lab Results

* Blood sample was collected from all `r nrow(sero_final_clean[sero_final_clean$q24_sample_collected=="yes",])` participants with the smallest proportion `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$sample_type =="original",])*100)/ nrow(sero_final_clean),1), "%)")` being original sample type and majority `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$q23_sampling =="yes",])*100)/ nrow(sero_final_clean),1), "%)")` willing to be sampled again to see what happens to test results.

* The top 3 participants blood groups by proportion (in descending order) were O+ `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$blood_group =="O+",])*100)/ nrow(sero_final_clean),1), "%)")` , A+ `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$blood_group =="A+",])*100)/ nrow(sero_final_clean),1), "%)")` and B+ `r paste0("(",round((nrow(sero_final_clean[sero_final_clean$blood_group =="B+",])*100)/ nrow(sero_final_clean),1), "%)")`. No participant had AB- blood group.


# **Inferential statistics**

## outcome variable (sero positive)

```{r all variables by outcome variable}

  tbl_summary(sero_final_analysis,
              by = spikepos,
                      type = list(
                        all_dichotomous() ~ "categorical"
                         ,all_continuous() ~ "continuous2"
                        )
                      , statistic = all_continuous() ~ c(
                                      "{mean} ({sd})", 
                                      "{median} ({p25}, {p75})", 
                                      "{min}, {max}")
                       , digits = list(all_continuous() ~ 2, 
                                      all_categorical() ~ c(0, 1))
                      ,percent = "row" #"column", "row", or "cell"
                      , missing = "always" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Variables**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  add_p(pvalue_fun = ~style_pvalue(.x, digits = 3)
        ,test.args = c(blood_group) ~ list(simulate.p.value=TRUE) ) %>%
   bold_p(t= 0.05) %>% # bold p-values under a given threshold (default 0.05)
  modify_spanning_header(c("stat_1", "stat_2") ~ "**sero positive**")%>%
  modify_footnote(
    all_stat_cols() ~ "Mean (SD); Median (IQR); Range; Frequency (%)"
  )%>%
  as_flex_table() #covert gtsummary object to flex table object. 

```

### sociodemographics of participants by outcome variable

* There was no significant difference in proportion between sero positive in categories of location (p=0.276), gender (p=0.897) and religion (p=0.278) groups.

* Participants with no formal education (27.0%) had significantly (p=0.003) lower proportion of sero positive compared to those with primary (39.8%), secondary (43.5%) and tertiary (43.2%) education. 

* Participants with sero positive had significant older age (35.09 $\pm$ 21.43 years, p=<0.001) compared to those of sero negative (27.00 $\pm$ 21.43 years).


### Health symptoms of participants by outcome variable

* Participants with history of fever/chills (32.9%) had significantly (p=0.047) lower proportion of sero positive compared to those with no history of fever/chills (40.1%). 

* Participants with history of diarrhoea (27.9%) had significantly (p=0.024) lower proportion of sero positive compared to those with no history of diarrhoea (39.3%). 

* Participants with history of cough (34.2%) had significantly (p=0.032) lower proportion of sero positive compared to those with no history of cough (41.3%). 

* Participants with history of runny nose (32.6%) had significantly (p=0.010) lower proportion of sero positive compared to those with no history of runny nose (41.3%).

* Participants with history of at least one symptom who missed work (44.4%) had significantly (p=0.010) higher proportion of sero positive compared to those with history of at least one symptom who did not miss work (34.4%).


### Health symptoms of household members by outcome variable

* Participants household members with history of being sick (32.6%) had significantly (p=0.022) lower proportion of sero positive compared to those participants household members with no history of being sick (40.7%).

* Participants household members with history of having at least one symptom (32.3%) had significantly (p=0.016) lower proportion of sero positive compared to those participants household members with no history of having at least one symptom (40.8%).

* Participants household members with history of fever/chills (25.7%) had significantly (p=0.001) lower proportion of sero positive compared to those participants household members with no history of fever/chills (40.4%). 

* Participants household members with history of runny nose (27.9%) had significantly (p=0.013) lower proportion of sero positive compared to those with participants household members no history of runny nose (39.7%).


### COVID-19 by outcome variable

* Participants unable to access and use healthcare services they would normally have access (27.1%) had significantly (p=0.013) lower proportion of sero positive compared to those able to access and use healthcare services they would normally have access (39.6%).


### Socio-economic status of participants by outcome variable

* Participants dwelling in household with cement floor (39.9%) had significantly (p=0.042) higher proportion of sero positive compared to those dwelling in household with earth/sand (31.2%) and other (16.7%) floor material.


### Migration, vaccination and blood group by outcome variable

* Participants who have a BCG scar (36.3%) had significantly (p=0.012) lower proportion of sero positive compared to those who did not have a BCG scar (47.0%).


## Location

```{r all variables by location}

  tbl_summary(sero_final_analysis,
              by = q9_location,
                      type = list(
                        all_dichotomous() ~ "categorical"
                         ,all_continuous() ~ "continuous2"
                        )
                      , statistic = all_continuous() ~ c(
                                      "{mean} ({sd})", 
                                      "{median} ({p25}, {p75})", 
                                      "{min}, {max}")
                       , digits = list(all_continuous() ~ 2, 
                                      all_categorical() ~ c(0, 1))
                      ,percent = "column" #"column", "row", or "cell"
                      , missing = "always" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Variables**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  add_p(pvalue_fun = ~style_pvalue(.x, digits = 3)
        ,test.args = c(q6_religion, q17_fuel_type, blood_group) ~ list(simulate.p.value=TRUE)) %>%
   bold_p(t= 0.05) %>% # bold p-values under a given threshold (default 0.05)
  #add_overall() %>%
  #add_difference() %>% #add column for difference between two group, confidence interval, and p-value
  modify_spanning_header(c("stat_1", "stat_2") ~ "**Location**")%>%
  #modify_caption("**Table 1. Patient Characteristics**")%>%
  modify_footnote(
    all_stat_cols() ~ "Mean (SD); Median (IQR); Range; Frequency (%)"
  )%>%
  as_flex_table() #covert gtsummary object to flex table object. 

```


## Gender

```{r all variables by gender}

  tbl_summary(sero_final_analysis,
              by = q8_gender,
                      type = list(
                        all_dichotomous() ~ "categorical"
                         ,all_continuous() ~ "continuous2"
                        )
                      , statistic = all_continuous() ~ c(
                                      "{mean} ({sd})", 
                                      "{median} ({p25}, {p75})", 
                                      "{min}, {max}")
                       , digits = list(all_continuous() ~ 2, 
                                      all_categorical() ~ c(0, 1))
                      ,percent = "column" #"column", "row", or "cell"
                      , missing = "always" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Variables**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  add_p(pvalue_fun = ~style_pvalue(.x, digits = 3)
        ,test.args = c(q6_religion, blood_group) ~ list(simulate.p.value=TRUE)) %>%
   bold_p(t= 0.05) %>% # bold p-values under a given threshold (default 0.05)
  #add_overall() %>%
  #add_difference() %>% #add column for difference between two group, confidence interval, and p-value
  modify_spanning_header(c("stat_1", "stat_2") ~ "**Gender**")%>%
  #modify_caption("**Table 1. Patient Characteristics**")%>%
  modify_footnote(
    all_stat_cols() ~ "Mean (SD); Median (IQR); Range; Frequency (%)"
  )%>%
  as_flex_table() #covert gtsummary object to flex table object. 

```


## Education level

```{r all variables by education level}

  tbl_summary(sero_final_analysis,
              by = q6_education_level,
                      type = list(
                        all_dichotomous() ~ "categorical"
                         ,all_continuous() ~ "continuous2"
                        )
                      , statistic = all_continuous() ~ c(
                                      "{mean} ({sd})", 
                                      "{median} ({p25}, {p75})", 
                                      "{min}, {max}")
                       , digits = list(all_continuous() ~ 2, 
                                      all_categorical() ~ c(0, 1))
                      ,percent = "column" #"column", "row", or "cell"
                      , missing = "always" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Variables**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  add_p(pvalue_fun = ~style_pvalue(.x, digits = 3)
        ,test.args = c(q6_religion, q10_covid_contact, q16_info_edu, q16_hand_wash, q16_face_masks, q19_lost_job,
                       q17_floor_type, q17_wall_type, q17_fuel_type, q17_toilet_type,
                       q18_outmigrant_member, q18_inmigrant_member, blood_group,
                       q12_hospitalized, q14_hhm_medical_attention,q14_hhm_miss_work,q14_hhm_hospitalized) ~ list(simulate.p.value=TRUE)) %>%
   bold_p(t= 0.05) %>% # bold p-values under a given threshold (default 0.05)
  #add_overall() %>%
  #add_difference() %>% #add column for difference between two group, confidence interval, and p-value
  modify_spanning_header(c("stat_1", "stat_2", "stat_3", "stat_4") ~ "**Education level**")  %>%
  #modify_caption("**Table 1. Patient Characteristics**")%>%
  modify_footnote(
    all_stat_cols() ~ "Mean (SD); Median (IQR); Range; Frequency (%)"
  )%>%
  as_flex_table() #covert gtsummary object to flex table object. 

```


## Age group

```{r all variables by age group}

  tbl_summary(sero_final_analysis,
              by = age_group_new,
                      type = list(
                        all_dichotomous() ~ "categorical"
                         ,all_continuous() ~ "continuous2"
                        )
                      , statistic = all_continuous() ~ c(
                                      "{mean} ({sd})", 
                                      "{median} ({p25}, {p75})", 
                                      "{min}, {max}")
                       , digits = list(all_continuous() ~ 2, 
                                      all_categorical() ~ c(0, 1))
                      ,percent = "column" #"column", "row", or "cell"
                      , missing = "always" #list missing data separately #ifany #no #always
                      ,missing_text = "Missing"
                      ) %>% 
  modify_header(label = "**Variables**") %>% # update the column header
  bold_labels() %>%
  italicize_levels()%>%
  add_n( statistic = "{n}", col_label = "**n**", last = FALSE, footnote = FALSE)%>% # add column with total number of non-missing observations
  add_p(pvalue_fun = ~style_pvalue(.x, digits = 3)
        ,test.args = c(q6_religion, q10_covid_contact, q16_hand_wash, q16_face_masks, q19_lost_job,
                       q17_floor_type, q17_fuel_type, q17_toilet_type,
                       q18_outmigrant_member, q18_inmigrant_member, blood_group,
                       q14_hhm_hospitalized) ~ list(simulate.p.value=TRUE)) %>%
   bold_p(t= 0.05) %>% # bold p-values under a given threshold (default 0.05)
  #add_overall() %>%
  #add_difference() %>% #add column for difference between two group, confidence interval, and p-value
  modify_spanning_header(c("stat_1", "stat_2", "stat_3", "stat_4") ~ "**Age group**")  %>%
  #modify_caption("**Table 1. Patient Characteristics**")%>%
  modify_footnote(
    all_stat_cols() ~ "Mean (SD); Median (IQR); Range; Frequency (%)"
  )%>%
  as_flex_table() #covert gtsummary object to flex table object. 

```


